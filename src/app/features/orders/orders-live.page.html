<!-- src/app/features/orders/orders-live.page.html -->

<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/"></ion-back-button>
    </ion-buttons>
    <ion-title>Ordini (live)</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div style="max-width: 980px; margin: 0 auto; padding: 12px; display: grid; gap: 12px;">

    <!-- Search + tabs stato -->
    <ion-searchbar placeholder="Cerca #id / cliente / canale"
      (ionInput)="q.set(($any($event).detail?.value ?? '').toString()); reload()">
    </ion-searchbar>

    <ion-segment value="{{ status() }}" (ionChange)="onStatusTab($any($event).detail?.value)">
      <ion-segment-button value="all">TUTTI</ion-segment-button>
      <ion-segment-button value="pending">PENDING</ion-segment-button>
      <ion-segment-button value="confirmed">CONFIRM</ion-segment-button>
      <ion-segment-button value="preparing">PREP</ion-segment-button>
      <ion-segment-button value="ready">READY</ion-segment-button>
      <ion-segment-button value="completed">DONE</ion-segment-button>
      <ion-segment-button value="cancelled">CANCEL</ion-segment-button>
    </ion-segment>

    <!-- timeframe semplice -->
    <div style="display:flex; gap:8px; align-items:center;">
      <ion-button [fill]="hours()===6?'solid':'outline'"  (click)="onHoursChange(6)">6H</ion-button>
      <ion-button [fill]="hours()===12?'solid':'outline'" (click)="onHoursChange(12)">12H</ion-button>
      <ion-button [fill]="hours()===24?'solid':'outline'" (click)="onHoursChange(24)">24H</ion-button>
      <ion-note style="opacity:.7">Live di default: <strong>6H</strong></ion-note>
    </div>

    <!-- Lista ordini -->
    <ion-list inset="true">
      <ion-item *ngFor="let o of filtered(); trackBy: trackById" lines="full">
        <ion-label>
          <div>
            <ion-badge [color]="statusColor(o.status)">{{ o.status }}</ion-badge>
            <strong> #{{ o.id }}</strong> — {{ o.customer_name }}
          </div>
          <div style="font-size:12px; opacity:.7">
            € {{ o.total | number:'1.2-2':'it-IT' }} • {{ o.channel || 'admin' }}
          </div>
        </ion-label>

        <!-- Azioni rapide -->
        <ion-buttons slot="end">
          <ion-button size="small" (click)="patchStatus(o, 'confirmed')">confirmed</ion-button>
          <ion-button size="small" color="danger" (click)="patchStatus(o, 'cancelled')">cancelled</ion-button>
        </ion-buttons>
      </ion-item>

      <ion-item lines="none" *ngIf="!filtered().length">
        <ion-label style="opacity:.7">Nessun ordine</ion-label>
      </ion-item>
    </ion-list>
  </div>
</ion-content>
