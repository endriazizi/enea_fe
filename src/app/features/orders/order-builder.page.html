<ion-header>
  <ion-toolbar>
    <ion-title>Nuovo ordine</ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/orders" routerDirection="back">Ordini</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>

  <!-- Form base ----------------------------------------------------------- -->
  <ion-item>
    <ion-label position="stacked">Cliente</ion-label>
    <ion-input
      autocomplete="name"
      [value]="customerName()"
      (ionInput)="onNameInput($any($event))">
    </ion-input>
  </ion-item>

  <ion-item>
    <ion-label position="stacked">Telefono</ion-label>
    <ion-input
      type="tel"
      autocomplete="tel"
      [value]="customerPhone()"
      (ionInput)="onPhoneInput($any($event))">
    </ion-input>
  </ion-item>

  <ion-item>
    <ion-label position="stacked">Note</ion-label>
    <ion-textarea
      autoGrow="true"
      placeholder="Es. senza cipolla"
      [value]="note()"
      (ionInput)="onNoteInput($any($event))">
    </ion-textarea>
  </ion-item>

  <!-- Categorie ----------------------------------------------------------- -->
  <div style="padding:12px 12px 0">
    <ion-segment [value]="selectedCategory()" (ionChange)="selectedCategory.set($any($event.detail).value || 'TUTTI')">
      <!-- FIX: typo chiusura corretta -->
      <ion-segment-button value="TUTTI">Tutti</ion-segment-button>
      <ion-segment-button *ngFor="let c of categories()" [value]="c">{{ c }}</ion-segment-button>
    </ion-segment>
  </div>

  <!-- Catalogo ------------------------------------------------------------ -->
  <ion-list inset="true">
    <ion-item *ngFor="let m of filteredMenu(); trackBy: trackByMenuName">
      <ion-label>
        <div><b>{{ m.name }}</b> <ion-badge *ngIf="m.category" color="medium">{{ m.category }}</ion-badge></div>
        <div>€ {{ m.price | number:'1.2-2' }}</div>
      </ion-label>

      <ion-buttons slot="end" style="gap:8px; align-items:center;">
        <ion-button fill="outline" (click)="decCart(m.name)">−</ion-button>
        <ion-note>{{ qtyInCart(m.name) }}</ion-note>
        <ion-button (click)="addToCart(m)">+</ion-button>
      </ion-buttons>
    </ion-item>
  </ion-list>

  <!-- Carrello ------------------------------------------------------------ -->
  <div style="padding:12px">
    <h3 style="margin:4px 0 8px;">Carrello</h3>
    <ion-list inset="true">
      <ion-item *ngFor="let it of cart(); trackBy: trackByCartName">
        <ion-label>{{ it.name }} × {{ it.qty }}</ion-label>
        <ion-note slot="end">€ {{ (it.price * it.qty) | number:'1.2-2' }}</ion-note>
      </ion-item>
      <ion-item>
        <ion-label><b>Totale</b></ion-label>
        <ion-note slot="end"><b>€ {{ total() | number:'1.2-2' }}</b></ion-note>
      </ion-item>
    </ion-list>

    <div style="display:flex; gap:10px; margin-top:10px;">
      <ion-button color="medium" fill="outline" (click)="clearCart()">Svuota</ion-button>
      <ion-button [disabled]="busy()" (click)="submit()">Conferma ordine</ion-button>
    </div>
  </div>

</ion-content>
