<!-- src/app/features/orders/orders-live.page.html -->
<ion-header>
  <ion-toolbar>
    <ion-title>Ordini</ion-title>
    <ion-buttons slot="end"><ion-button routerLink="/orders/new">Nuovo</ion-button></ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <div class="filters">
    <ion-segment [value]="status()" (ionChange)="status.set($any($event.detail).value); load()">
      <ion-segment-button value="all">Tutti</ion-segment-button>
      <ion-segment-button *ngFor="let s of statuses" [value]="s">{{ s | uppercase }}</ion-segment-button>
    </ion-segment>

    <ion-item lines="none">
      <ion-label>Ultime ore</ion-label>
      <ion-input type="number" [value]="hours()" (ionInput)="hours.set(+$any($event.target).value || 6)"></ion-input>
      <ion-button (click)="load()">Aggiorna</ion-button>
    </ion-item>
  </div>

  <ion-grid>
    <ion-row>
      <ion-col size="12" size-md="6" size-lg="4" *ngFor="let o of rows()">
        <ion-card (dblclick)="setStatus(o,'completed')">
          <ion-card-header>
            <ion-card-title>#{{ o.id }} — {{ o.status | uppercase }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="meta">
              <div><b>{{ o.customer_name || '—' }}</b></div>
              <div>{{ o.created_at | date:'HH:mm' }}</div>
            </div>
            <div class="note">{{ o.note }}</div>

            <div class="actions">
              <ion-button size="small" (click)="openDetail(o)">Vedi</ion-button>
              <ion-button size="small" color="medium" (click)="setStatus(o,'confirmed')">Conferma</ion-button>
              <ion-button size="small" color="warning" (click)="setStatus(o,'preparing')">Prepara</ion-button>
              <ion-button size="small" color="tertiary" (click)="setStatus(o,'ready')">Pronto</ion-button>
              <ion-button size="small" color="success" (click)="setStatus(o,'completed')">Consegnato</ion-button>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Dettaglio -->
  <ion-modal [isOpen]="detailOpen()">
    <ng-template>
      <ion-header><ion-toolbar><ion-title>Ordine #{{ detail()?.id }}</ion-title>
        <ion-buttons slot="end"><ion-button (click)="closeDetail()">Chiudi</ion-button></ion-buttons>
      </ion-toolbar></ion-header>
      <ion-content class="ion-padding">
        <ion-list *ngIf="detail() as d">
          <ion-item *ngFor="let it of d.items">
            <ion-label>{{ it.name }} × {{ it.qty }}</ion-label>
            <ion-note slot="end">€ {{ (it.price * it.qty) | number:'1.2-2' }}</ion-note>
          </ion-item>
          <ion-item>
            <ion-label><b>Totale</b></ion-label>
            <ion-note slot="end"><b>€ {{ detailTotal() | number:'1.2-2' }}</b></ion-note>
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>
