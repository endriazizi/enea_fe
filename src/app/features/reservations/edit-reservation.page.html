<!-- src/app/features/reservations/edit-reservation.page.html -->
<ion-header>
  <ion-toolbar>
    <ion-title>Modifica prenotazione</ion-title>

    <!-- Toolbar destra: mantengo la tua UI -->
    <ion-buttons slot="end" class="ion-hide-sm-down">
      <ion-button [disabled]="printing()" (click)="onPrintPlacecardOne()" title="Stampa segnaposto">
        <ion-icon name="print-outline" slot="start"></ion-icon>
        Stampa segnaposto
      </ion-button>

      <!-- 🗑️ Elimina definitivamente (solo se status = cancelled) -->
      <ion-button
        color="danger"
        [disabled]="loading()"
        *ngIf="entity()?.status === 'cancelled'"
        (click)="onDeleteDefinitive()"
        title="Elimina definitivamente">
        <ion-icon name="trash-outline" slot="start"></ion-icon>
        Elimina definitivamente
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div style="max-width:880px; margin:0 auto; padding:16px;" *ngIf="entity(); else notFound">
    <form [formGroup]="form" (ngSubmit)="onSave()">

      <!-- ===== Dati cliente ===== -->
      <ion-list inset="true">
        <ion-item lines="full">
          <ion-label position="stacked">Cognome</ion-label>
          <ion-input
            formControlName="customer_last"
            placeholder="Rossi"
            autocapitalize="off"
            autocomplete="family-name"
            enterkeyhint="next"
            clear-input="true"
            style="text-transform: uppercase"
            (ionInput)="forceUpper('customer_last', $event)">
          </ion-input>
        </ion-item>

        <ion-item lines="full" style="margin-top:8px;">
          <ion-label position="stacked">Nome</ion-label>
          <ion-input
            formControlName="customer_first"
            placeholder="Mario"
            autocapitalize="off"
            autocomplete="given-name"
            enterkeyhint="next"
            clear-input="true"
            style="text-transform: uppercase"
            (ionInput)="forceUpper('customer_first', $event)">
          </ion-input>
        </ion-item>

        <ion-item lines="full" style="margin-top:8px;">
          <ion-label position="stacked">Telefono</ion-label>
          <ion-input
            formControlName="phone"
            type="tel"
            inputmode="tel"
            autocomplete="tel-national"
            placeholder="+39 333 123 4567"
            enterkeyhint="next"
            clear-input="true">
          </ion-input>
        </ion-item>

        <ion-item lines="full" style="margin-top:8px;">
          <ion-label position="stacked">Email</ion-label>
          <ion-input
            formControlName="email"
            type="email"
            autocomplete="email"
            placeholder="mario@example.com"
            enterkeyhint="next"
            clear-input="true">
          </ion-input>
        </ion-item>
      </ion-list>

      <!-- ===== Dati prenotazione ===== -->
      <ion-list inset="true" style="margin-top: 12px;">
        <ion-item lines="full">
          <ion-label position="stacked">Persone</ion-label>
          <ion-input type="number" formControlName="party_size" min="1"></ion-input>
        </ion-item>

        <ion-item lines="full" style="margin-top:8px;">
          <ion-label position="stacked">Inizio (UTC ISO)</ion-label>
          <ion-input formControlName="start_at"></ion-input>
        </ion-item>

        <ion-item lines="full" style="margin-top:8px;">
          <ion-label position="stacked">Fine (UTC ISO)</ion-label>
          <ion-input formControlName="end_at"></ion-input>
        </ion-item>

        <ion-item lines="full" style="margin-top:8px;">
          <ion-label position="stacked">Sala</ion-label>
          <ion-select formControlName="room_id" (ionChange)="onRoomChange($event.detail.value)">
            <ion-select-option *ngFor="let r of rooms()" [value]="r.id">{{ r.name }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item lines="full" style="margin-top:8px;">
          <ion-label position="stacked">Tavolo</ion-label>
          <ion-select formControlName="table_id">
            <ion-select-option *ngFor="let t of tables()" [value]="t.id">{{ t.name }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item lines="full" style="margin-top:8px;">
          <ion-label position="stacked">Note</ion-label>
          <ion-textarea formControlName="notes" placeholder="intolleranze, preferenze, segnalazioni…"></ion-textarea>
        </ion-item>
      </ion-list>

      <!-- CTA -->
      <div style="padding: 12px 8px">
        <ion-button expand="block" size="large" type="submit" [disabled]="loading() || form.invalid">
          {{ loading() ? 'Salvataggio…' : 'Salva' }}
        </ion-button>
      </div>
    </form>
  </div>

  <ng-template #notFound>
    <div style="padding:16px">Prenotazione non trovata.</div>
  </ng-template>

  <!-- FAB mobile: invariato -->
  <ion-fab slot="fixed" horizontal="end" vertical="bottom" class="ion-hide-md-up fab-resv">
    <ion-fab-button title="Azioni">
      <ion-icon name="ellipsis-vertical"></ion-icon>
    </ion-fab-button>

    <ion-fab-list side="top">
      <ion-fab-button routerLink="/reservations" title="Vai alla lista">
        <ion-icon name="list"></ion-icon>
      </ion-fab-button>

      <ion-fab-button [disabled]="printing()" (click)="onPrintPlacecardOne()" title="Stampa segnaposto">
        <ion-icon name="print-outline"></ion-icon>
      </ion-fab-button>
    </ion-fab-list>
  </ion-fab>
</ion-content>
