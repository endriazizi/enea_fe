<!-- src/app/features/reservations/reservations-list.page.html -->
<ion-header>
  <ion-toolbar>
    <ion-title>Prenotazioni</ion-title>

    <!-- UI Desktop: pulsanti con icona+testo (niente cambi UX, solo comodo su desktop) -->
    <ion-buttons slot="end" class="ion-hide-md-down">
      <ion-button (click)="openFilterSheet()" title="Filtri">
        <ion-icon slot="start" name="funnel-outline"></ion-icon>
        Filtri
      </ion-button>
      <ion-button [disabled]="printing()" (click)="printTodayThermal()" title="Stampa termica (oggi)">
        <ion-icon slot="start" name="print-outline"></ion-icon>
        Stampa oggi
      </ion-button>
      <ion-button [disabled]="printing()" (click)="printPlacecardsToday()" title="Segnaposti (oggi)">
        <ion-icon slot="start" name="document-text-outline"></ion-icon>
        Segnaposti
      </ion-button>
      <ion-button routerLink="/reservations/new" title="Nuova prenotazione">
        <ion-icon slot="start" name="create-outline"></ion-icon>
        Nuova
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Ricerca -->
  <ion-searchbar placeholder="Cerca per nome/telefono/email" (ionInput)="onSearchChange($event)"></ion-searchbar>

  <!-- Pull-to-refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="load($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Lista prenotazioni -->
  <ion-list inset="true">
    <!-- ⚠️ FIX iOS/Android: NIENTE 'button' su ion-item; uso (click) sul container.
         Evita il caso 'button dentro button' con i pulsanti nello slot=end. -->
    <ion-item
      *ngFor="let r of rows(); trackBy: trackById"
      lines="full"
      detail="false"
      (click)="openEdit(r)"
      class="resv-row">

      <ion-label>
        <div style="display:flex; align-items:center; gap:8px; margin-bottom:2px;">
          <ion-badge [color]="getStatusColor(r.status)">{{ r.status }}</ion-badge>
          <b>{{ r.customer_first }} {{ r.customer_last }}</b>
          <span style="opacity:.6">· #{{ r.id }}</span>
        </div>

        <div style="font-size:12px; margin-top:2px;">
          {{ r.phone || '—' }}
          <span *ngIf="r.email" style="opacity:.6"> · {{ r.email }}</span>
          <span style="opacity:.6"> · {{ r.party_size }} coperti</span>
        </div>

        <div style="font-size:12px; margin-top:2px; opacity:.8;">
          {{ r.start_at | date:'EEEE dd/MM/yyyy, H:mm':'':'it-IT' }}
          →
          {{ r.end_at   | date:'EEEE dd/MM/yyyy, H:mm':'':'it-IT' }}
          <span *ngIf="r.table_number"> · Tavolo {{ r.table_number }}</span>
        </div>

        <div *ngIf="r.notes" style="margin-top:4px; opacity:.7;">Note: {{ r.notes }}</div>
      </ion-label>

      <!-- Azioni riga: cliccabili su iOS/Android (no annidamento button) -->
      <ion-buttons slot="end" class="row-actions">
        <ion-button fill="clear" (click)="onActionsClick($event, r)" title="Azioni">
          <ion-icon name="ellipsis-vertical"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-item>
  </ion-list>

  <!-- FAB mobile, invariato -->
  <ion-fab slot="fixed" horizontal="end" vertical="bottom" class="ion-hide-md-up">
    <ion-fab-button title="Azioni">
      <ion-icon name="ellipsis-vertical"></ion-icon>
    </ion-fab-button>
    <ion-fab-list side="top">
      <ion-fab-button (click)="openFilterSheet()" title="Filtri">
        <ion-icon name="funnel-outline"></ion-icon>
      </ion-fab-button>
      <ion-fab-button [disabled]="printing()" (click)="printTodayThermal()" title="Stampa termica (oggi)">
        <ion-icon name="print-outline"></ion-icon>
      </ion-fab-button>
      <ion-fab-button [disabled]="printing()" (click)="printPlacecardsToday()" title="Segnaposti (oggi)">
        <ion-icon name="document-text-outline"></ion-icon>
      </ion-fab-button>
      <ion-fab-button routerLink="/reservations/new" title="Nuova prenotazione">
        <ion-icon name="create-outline"></ion-icon>
      </ion-fab-button>
    </ion-fab-list>
  </ion-fab>
</ion-content>
